(()=>{var e={};e.id=996,e.ids=[996],e.modules={3131:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>y,routeModule:()=>w,serverHooks:()=>v,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{GET:()=>x});var n=r(96559),o=r(48088),i=r(37719),a=r(32190),u=r(51455),c=r.n(u),l=r(76760),p=r.n(l),d=r(12909);let f=p().join(process.cwd(),"zipped_repos");async function x(e){let t;if(!await (0,d.K5)(e))return a.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:r}=e.nextUrl,s=r.get("fileName");if(!s)return a.NextResponse.json({error:"File name is required"},{status:400});if(s.includes("..")||s.includes("/")||!s.endsWith(".zip"))return a.NextResponse.json({error:"Invalid file name or type"},{status:400});let n=p().join(f,s);try{await c().access(n)}catch(e){return console.error(`File not found: ${n}`,e),a.NextResponse.json({error:"File not found or access denied"},{status:404})}try{t=await c().readFile(n)}catch(e){return console.error(`Error reading file ${n}:`,e),a.NextResponse.json({error:"Error processing file"},{status:500})}let o=new Headers;o.set("Content-Type","application/zip"),o.set("Content-Disposition",`attachment; filename="${s}"`);let i=new a.NextResponse(t,{status:200,headers:o});try{await c().unlink(n),console.log(`Successfully deleted ${n} from server after preparing for download.`)}catch(e){console.error(`Error deleting file ${n} after download attempt:`,e)}return i}let w=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/download-zip/route",pathname:"/api/download-zip",filename:"route",bundlePath:"app/api/download-zip/route"},resolvedPagePath:"/home/user/studio/src/app/api/download-zip/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:m,serverHooks:v}=w;function y(){return(0,i.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:m})}},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4573:e=>{"use strict";e.exports=require("node:buffer")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12909:(e,t,r)=>{"use strict";r.d(t,{Ht:()=>p,K5:()=>f,ME:()=>d,jw:()=>l});var s=r(76784),n=r(99302),o=r(44999);r(32190);let i=process.env.AUTH_SECRET;if(!i)throw Error("AUTH_SECRET environment variable is not set");let a=new TextEncoder().encode(i);async function u(e){return await new s.P(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("1h").sign(a)}async function c(e){try{let{payload:t}=await (0,n.V)(e,a,{algorithms:["HS256"]});return t}catch(e){return console.error("JWT verification failed:",e),null}}async function l(e){let t=new Date(Date.now()+36e5),r=await u(e);(0,o.UL)().set("session",r,{expires:t,httpOnly:!0,secure:!0,path:"/"})}async function p(){let e=o.UL().get("session")?.value;if(!e)return null;let t=await c(e);return t&&t.userId&&t.accessToken?t:null}async function d(){(0,o.UL)().delete("session")}async function f(e){let t=e.cookies.get("session")?.value;if(!t)return null;let r=await c(t);return r&&r.userId&&r.accessToken?r:null}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},51455:e=>{"use strict";e.exports=require("node:fs/promises")},57975:e=>{"use strict";e.exports=require("node:util")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},76760:e=>{"use strict";e.exports=require("node:path")},77598:e=>{"use strict";e.exports=require("node:crypto")},78335:()=>{},96487:()=>{},96559:(e,t,r)=>{"use strict";e.exports=r(44870)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[80,919],()=>r(3131));module.exports=s})();